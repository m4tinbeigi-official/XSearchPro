<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ابزار جستجوی پیشرفته توییتر</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Vazir Font -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      background: #fff;
      margin-bottom: 5px;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    .history-item button {
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">ابزار جستجوی پیشرفته توییتر</h2>

    <!-- فرم جستجو -->
    <form id="searchForm" class="mb-4">
      <div class="mb-3">
        <label for="keywords" class="form-label">کلمات کلیدی</label>
        <input type="text" class="form-control" id="keywords" placeholder="مثال: آموزش جاوااسکریپت">
      </div>
      <div class="mb-3">
        <label for="hashtag" class="form-label">هشتگ</label>
        <input type="text" class="form-control" id="hashtag" placeholder="مثال: #برنامه_نویسی">
      </div>
      <div class="mb-3">
        <label for="mention" class="form-label">منشن</label>
        <input type="text" class="form-control" id="mention" placeholder="مثال: @username">
      </div>
      <div class="mb-3">
        <label for="contentType" class="form-label">نوع محتوا</label>
        <select class="form-select" id="contentType">
          <option value="">همه</option>
          <option value="image">تصویر</option>
          <option value="video">ویدیو</option>
          <option value="link">لینک</option>
          <option value="text">متن</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">تاریخ</label>
        <div class="d-flex gap-2">
          <input type="date" class="form-control" id="startDate">
          <input type="date" class="form-control" id="endDate">
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">دامنه جستجو</label>
        <select class="form-select" id="scope">
          <option value="all">همه توییتر</option>
          <option value="from_user">توییت‌های کاربر خاص</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">جستجو</button>
    </form>

    <!-- لینک اشتراک گذاری -->
    <div class="mb-3">
      <label class="form-label">لینک اشتراک گذاری:</label>
      <div class="input-group">
        <input type="text" id="shareLink" class="form-control" readonly>
        <button class="btn btn-outline-secondary" id="copyLink">کپی</button>
      </div>
    </div>

    <!-- تاریخچه جستجو -->
    <div>
      <h4>تاریخچه جستجوها</h4>
      <div id="historyList"></div>
      <button class="btn btn-danger btn-sm mt-2" id="clearHistory">پاک کردن تاریخچه</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('searchForm');
    const shareLink = document.getElementById('shareLink');
    const historyList = document.getElementById('historyList');

    // بارگذاری فرم از URL
    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      if(params.toString() !== '') {
        document.getElementById('keywords').value = params.get('keywords') || '';
        document.getElementById('hashtag').value = params.get('hashtag') || '';
        document.getElementById('mention').value = params.get('mention') || '';
        document.getElementById('contentType').value = params.get('contentType') || '';
        document.getElementById('startDate').value = params.get('startDate') || '';
        document.getElementById('endDate').value = params.get('endDate') || '';
        document.getElementById('scope').value = params.get('scope') || 'all';
      }
    }

    // ذخیره تاریخچه در localStorage
    function saveHistory(searchObj) {
      let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
      history.unshift(searchObj);
      localStorage.setItem('searchHistory', JSON.stringify(history.slice(0, 20)));
      renderHistory();
    }

    // نمایش تاریخچه
    function renderHistory() {
      let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
      historyList.innerHTML = '';
      history.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <span>${item.keywords || ''} ${item.hashtag || ''} ${item.mention || ''}</span>
          <div>
            <button class="btn btn-sm btn-primary" onclick='applyHistory(${index})'>بارگذاری</button>
          </div>
        `;
        historyList.appendChild(div);
      });
    }

    // بارگذاری جستجوی تاریخچه
    function applyHistory(index) {
      let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
      const item = history[index];
      document.getElementById('keywords').value = item.keywords;
      document.getElementById('hashtag').value = item.hashtag;
      document.getElementById('mention').value = item.mention;
      document.getElementById('contentType').value = item.contentType;
      document.getElementById('startDate').value = item.startDate;
      document.getElementById('endDate').value = item.endDate;
      document.getElementById('scope').value = item.scope;
      generateLink();
    }

    // پاک کردن تاریخچه
    document.getElementById('clearHistory').addEventListener('click', () => {
      localStorage.removeItem('searchHistory');
      renderHistory();
    });

    // ساخت لینک جستجو توییتر
    function generateTwitterURL({keywords, hashtag, mention, contentType, startDate, endDate, scope}) {
      let query = '';
      if(keywords) query += keywords + ' ';
      if(hashtag) query += hashtag + ' ';
      if(mention) query += mention + ' ';
      if(contentType) {
        if(contentType === 'image') query += 'filter:images ';
        else if(contentType === 'video') query += 'filter:videos ';
        else if(contentType === 'link') query += 'filter:links ';
      }
      if(scope === 'from_user' && mention) query += `from:${mention.replace('@','')} `;
      if(startDate) query += `since:${startDate} `;
      if(endDate) query += `until:${endDate} `;

      return 'https://twitter.com/search?q=' + encodeURIComponent(query.trim()) + '&src=typed_query';
    }

    // ساخت لینک اشتراک گذاری
    function generateShareLink() {
      const params = new URLSearchParams({
        keywords: document.getElementById('keywords').value,
        hashtag: document.getElementById('hashtag').value,
        mention: document.getElementById('mention').value,
        contentType: document.getElementById('contentType').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        scope: document.getElementById('scope').value
      });
      return window.location.origin + window.location.pathname + '?' + params.toString();
    }

    // فرم ارسال
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const searchObj = {
        keywords: document.getElementById('keywords').value,
        hashtag: document.getElementById('hashtag').value,
        mention: document.getElementById('mention').value,
        contentType: document.getElementById('contentType').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        scope: document.getElementById('scope').value
      };
      saveHistory(searchObj);
      const twitterURL = generateTwitterURL(searchObj);
      shareLink.value = generateShareLink();
      window.open(twitterURL, '_blank');
    });

    // کپی لینک اشتراک گذاری
    document.getElementById('copyLink').addEventListener('click', () => {
      shareLink.select();
      shareLink.setSelectionRange(0, 99999);
      document.execCommand('copy');
      alert('لینک کپی شد!');
    });

    // بارگذاری اولیه
    loadFromURL();
    renderHistory();
    shareLink.value = generateShareLink();
  </script>
</body>
</html>
